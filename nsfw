#!/bin/sh

[ -z "$*" ] && printf "enter(paste) number or link:" && read -r num || num=$*
num=$(printf "$num" | cut -d\/ -f5)
dir="$HOME/.cache/$num"
mkdir -p $dir
trap "rm -rf $dir;exit 0" INT HUP
pg=$(curl -s "https://nhentai.net/g/$num/1/" | sed -nE 's/.*pages">(.*)<\/span><.*/\1/p')
[ -z "$pg" ] && echo "\033[1;31mDoujin doesn't exist!!\033[0m" && exit 0
echo "\033[1;34m pages : $pg\n\033[1;33mdownloading pages>>"
for i in $(seq $pg);do
	url=$(curl -s "https://nhentai.net/g/$num/$i/" | sed -nE 's/.*<img src="([^"]*)".*/\1/p')
	i_t=$(printf "%03d" $i)
	curl -s "$url" -o "$dir/$i_t" && printf "\033[1;32m $i ✓," || printf "\033[1;31m $i ❌," &
done
wait
echo "\n\033[1;36mconcatenating pages to pdf"
convert "$dir/*" "/storage/7689-5BBD/$num.pdf" && echo "\033[1;35msaved pdf as $num.pdf...enjoy 😏😏\033[0m" 
rm -rf $dir
