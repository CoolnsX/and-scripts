#!/bin/sh

[ -z "$*" ] && printf "enter number or link:" && read -r num || num=$*
num=$(printf "$num" | cut -d\/ -f5)
dir="$HOME/.cache/$num"
mkdir -pv $dir
trap "rm -rf $dir;exit 0" INT HUP
pg=$(curl -s "https://nhentai.net/g/$num/1/" | sed -nE 's/.*pages">(.*)<\/span><.*/\1/p')
echo "pages : $pg"
for i in $(seq $pg);do
	url=$(curl -s "https://nhentai.net/g/$num/$i/" | sed -nE 's/.*<img src="([^"]*)".*/\1/p')
	i_t=$(printf "%03d" $i)
	echo "downloading page $i"
	setsid -f curl -s "$url" -o "$dir/$i_t"
	sleep 2
done
echo "waiting 5 sec for pages to download completely"
sleep 5
echo "concat pages to pdf"
convert "$dir/*" "7689-5BBD/sem-6/$num.pdf" && echo "saved pdf in 7689-5BBD/sem-6/$num.pdf\nenjoy 😏😏"
rm -rvf $dir
